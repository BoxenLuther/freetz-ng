name: teeest

on:
  push:
    branches: [ master ]
    paths:
      - '.github/workflows/teeest.yml'
  workflow_dispatch:

concurrency:
  group: ${{ github.workflow }}
  cancel-in-progress: false

jobs:
  build:
    container:
#     image: ubuntu:20.04
#     image: freetzng/firmware
      image: ghcr.io/freetz-ng/firmware
      options: --user 1001:1001
#   strategy:
#     fail-fast: false
#     max-parallel: 17
#     matrix:
#       fritz: [ "" ]
    runs-on: ubuntu-latest
#   if: github.repository == 'freetz-ng/freetz-ng'

    env:
      CACHE_KEY: "${{ github.workflow }}"
    steps:

#     - name: update
#       run: apt-get -y update && apt-get -y upgrade && apt-get -y dist-upgrade
#
#     - name: install
#       run: |
#         DEBIAN_FRONTEND=noninteractive apt-get -y install \
#           locales \
#           pv cpio rsync kmod imagemagick inkscape graphicsmagick subversion git bc unar wget sudo gcc g++ binutils autoconf automake \
#           autopoint libtool-bin make bzip2 libncurses5-dev libreadline-dev zlib1g-dev flex bison patch texinfo tofrodos gettext pkg-config ecj \
#           perl libstring-crc32-perl ruby gawk libusb-dev unzip intltool libacl1-dev libcap-dev libc6-dev-i386 \
#           lib32ncurses5-dev gcc-multilib bsdmainutils lib32stdc++6 libglib2.0-dev ccache cmake lib32z1-dev libsqlite3-dev sqlite3 libzstd-dev \
#           netcat curl uuid-dev libssl-dev libgnutls28-dev u-boot-tools device-tree-compiler
#
#     - name: locale
#       run: locale-gen en_US.utf8 && locale-gen de_DE.UTF-8 && update-locale

      - name: myips
        run: |
          echo -n "IP: " ; wget -q https://ipaddress.ai    -O - || echo none
#         echo -n "V4: " ; wget -q https://ipaddress.ai -4 -O - || echo none
#         echo -n "V6: " ; wget -q https://ipaddress.ai -6 -O - || echo none

      - name: teeest
        run: |
          echo
          echo "/etc/passwd"
          cat /etc/passwd || true
          echo
          echo "/etc/group"
          cat /etc/group || true
          echo
          echo "/etc/sudoers"
          cat /etc/sudoers || true
          echo
          echo "HOME=$HOME"
          echo "DIR=$PWD"
          echo "TMP=$(mktemp -u || true)"
          cd ~/
          pwd || true
          echo
          df -h || true
          echo
          free || true
          echo
          uname -a || true
          echo
          su root -c "id" || true
          id || true
          whoami || true
          echo
          echo "env"
          env || true
          echo
          echo "/__w/freetz-ng/freetz-ng"
          ls -al /__w/freetz-ng/freetz-ng || true
          echo
          echo "/__w/freetz-ng"
          ls -al /__w/freetz-ng || true
          echo
          echo "/__w"
          ls -al /__w || true
          echo
          echo "/github/home/"
          ls -al /github/home/ || true
          echo
          echo "/github/"
          ls -al /github/ || true
          echo
          echo "/home/"
          ls -al /home/ || true
          echo
          echo "/"
          ls -al / || true
          echo
          echo "/workspace"
          ls -al /workspace || true
          echo
          echo "useradd"
          useradd --help
          echo
          echo "usermod"
          usermod --help

      - name: clone
        uses: actions/checkout@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          set-safe-directory: true
          repository: ${{ github.repository }}
          ref: ${{ github.ref_name }}
          path: ${{ github.workspace }}
          fetch-depth: 0
          clean: false
          persist-credentials: true


